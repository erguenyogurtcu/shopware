{% if feature('cache_rework') %}
    {# @var navigation \Shopware\Core\Content\Category\Dto\Navigation #}
    {% set activeId = navigationId %}
    {% set isRoot = activeId == navigation.root %}
    {% set children = navigation.items %}
{% else %}
    {# @var navigation \Shopware\Core\Content\Category\Tree\Tree #}
    {% set activeId = navigationId %}
    {% set isRoot = activeId == context.salesChannel.navigationCategoryId %}
    {% set children = navigation.getChildren(activeId) %}
    {% set active = navigation.active %}
{% endif %}

{% block layout_navigation_offcanvas_navigation_categories %}
    <div class="navigation-offcanvas-container js-navigation-offcanvas">
        <div class="navigation-offcanvas-overlay-content js-navigation-offcanvas-overlay-content">
            {% if feature('cache_rework') %}
                {% sw_include '@Storefront/storefront/layout/navigation/offcanvas/general-headline.html.twig' %}
            {% else %}
                {% if not isRoot %}
                    {% sw_include '@Storefront/storefront/layout/navigation/offcanvas/show-all-link.html.twig' %}

                    {% sw_include '@Storefront/storefront/layout/navigation/offcanvas/active-item-link.html.twig' with { item: active } %}

                    {% sw_include '@Storefront/storefront/layout/navigation/offcanvas/back-link.html.twig' with { item: active } %}
                {% else %}
                    {% sw_include '@Storefront/storefront/layout/navigation/offcanvas/general-headline.html.twig' %}
                {% endif %}
            {% endif %}

            <ul class="list-unstyled navigation-offcanvas-list">
                {% if not feature('cache_rework') %}
                    {% if not isRoot and page.navigation.active.type != 'folder' %}
                        {% sw_include '@Storefront/storefront/layout/navigation/offcanvas/show-active-link.html.twig' with { item: active } %}
                    {% endif %}
                {% endif %}

                {% if feature('cache_rework') %}
                    {# @var item \Shopware\Core\Content\Category\Tree\TreeItem #}
                    {% for item in children.items %}
                        {% sw_include '@Storefront/storefront/layout/navigation/offcanvas/item-link.html.twig' with { item: item } %}
                    {% endfor %}
                {% else %}
                    {# @var item \Shopware\Core\Content\Category\Tree\TreeItem #}
                    {% for item in children.tree %}
                        {% sw_include '@Storefront/storefront/layout/navigation/offcanvas/item-link.html.twig' with { item: item, activeId: activeId } %}
                    {% endfor %}
                {% endif %}
            </ul>
        </div>
    </div>
{% endblock %}
